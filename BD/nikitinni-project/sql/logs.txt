create schema if not exists vk_audience;
CREATE SCHEMA
set search_path = vk_audience;
SET
create table if not exists Users (
user_id bigint primary key,
first_name text not null,
last_name text not null,
can_access_closed boolean not null,
is_closed boolean not null,
deactivated text,
total_friends bigint
);
CREATE TABLE
create table if not exists Groups (
group_id bigint primary key,
name text not null
);
CREATE TABLE
create table if not exists Groups_x_Users (
group_id bigint not null,
user_id bigint not null
);
CREATE TABLE
create table if not exists Influencers (
user_id bigint primary key,
first_name text not null,
last_name text not null
);
CREATE TABLE
create table if not exists Influencers_x_Users (
influencer_id bigint not null,
user_id bigint not null
);
CREATE TABLE
create table if not exists Posts (
post_id bigint,
owner_id bigint,
text text,
release_date timestamp,
primary key (post_id, owner_id)
);
CREATE TABLE
create table if not exists Comments (
comment_id bigint,
owner_id bigint,
post_id bigint,
author_id bigint not null,
text text,
likes bigint,
primary key (comment_id, owner_id, post_id)
);
CREATE TABLE
create table if not exists Friendships (
user_id bigint not null,
friend_id bigint not null,
valid_from_dtm timestamp not null,
valid_to_dtm timestamp not null
);
CREATE TABLE
set search_path = vk_audience;
SET
-- TAG: Groups
INSERT INTO Groups
VALUES (198081409,'–§–ü–ú–ò 2 –∫—É—Ä—Å (–Ω–∞–±–æ—Ä 2020)');
INSERT 0 1
INSERT INTO Groups
VALUES (207840928,'–§–ü–ú–ò.C—Ç—É–¥–µ–Ω—Ç–∞–º');
INSERT 0 1
-- TAG: Users
INSERT INTO Users
(user_id,first_name,last_name,can_access_closed,is_closed)
VALUES
(1000912,'–ê–ª–µ–∫—Å–∞–Ω–¥—Ä','–†—É–±—Ü–æ–≤',True,False) 
ON CONFLICT (user_id) DO NOTHING;
INSERT 0 1
INSERT INTO Users
(user_id,first_name,last_name,can_access_closed,is_closed)
VALUES
(1151988,'–í–∏–∫—Ç–æ—Ä','–Ø–∫–æ–≤–ª–µ–≤',True,False)
ON CONFLICT (user_id) DO NOTHING;
INSERT 0 1
INSERT INTO Users
(user_id,first_name,last_name,can_access_closed,is_closed)
VALUES
(1373062,'–ï–≤–≥–µ–Ω–∏–π','–®–µ–≤—á–µ–Ω–∫–æ',False,True)
ON CONFLICT (user_id) DO NOTHING;
INSERT 0 1
INSERT INTO Users
(user_id,first_name,last_name,can_access_closed,is_closed)
VALUES
(1648578,'–ê–ª–µ–∫—Å–∞–Ω–¥—Ä','–û—Ä–ª–æ–≤',False,True)
ON CONFLICT (user_id) DO NOTHING;
INSERT 0 1
INSERT INTO Users
(user_id,first_name,last_name,can_access_closed,is_closed)
VALUES
(2153814,'–ï–≤–≥–µ–Ω–∏–π','–ú–æ–ª—á–∞–Ω–æ–≤',True,False)
ON CONFLICT (user_id) DO NOTHING;
INSERT 0 1
INSERT INTO Users
(user_id,first_name,last_name,can_access_closed,is_closed)
VALUES
(2300155,'–ê–ª–∏–Ω–∞','–ö—É–∑–Ω–µ—Ü–æ–≤–∞',True,False)
ON CONFLICT (user_id) DO NOTHING;
INSERT 0 1
INSERT INTO Users
(user_id,first_name,last_name,can_access_closed,is_closed)
VALUES
(2483126,'–°–∞—à–∞','–°–µ–Ω—å–∫–æ–≤–∞',True,False)
ON CONFLICT (user_id) DO NOTHING;
INSERT 0 1
INSERT INTO Users
(user_id,first_name,last_name,can_access_closed,is_closed)
VALUES
(3162776,'–ú–∞—Ä–∏—è','–£—Ç–∫–∏–Ω–∞',False,True)
ON CONFLICT (user_id) DO NOTHING;
INSERT 0 1
INSERT INTO Users
(user_id,first_name,last_name,can_access_closed,is_closed)
VALUES
(3656763,'–ò–≤–∞–Ω','–≠—Ä–ª–∏—Ö',True,False)
ON CONFLICT (user_id) DO NOTHING;
INSERT 0 1
INSERT INTO Users
(user_id,first_name,last_name,can_access_closed,is_closed)
VALUES
(4044482,'–ù–∞—Ç–∞–ª—å—è','–ú–∞—Å—Ç–∏–Ω–µ–Ω',False,True)
ON CONFLICT (user_id) DO NOTHING;
INSERT 0 1
-- TAG: Groups_x_Users
INSERT INTO Groups_x_Users
VALUES (198081409, 1000912);
INSERT 0 1
INSERT INTO Groups_x_Users
VALUES (198081409, 1151988);
INSERT 0 1
INSERT INTO Groups_x_Users
VALUES (198081409, 1373062);
INSERT 0 1
INSERT INTO Groups_x_Users
VALUES (198081409, 1648578);
INSERT 0 1
INSERT INTO Groups_x_Users
VALUES (198081409, 2153814);
INSERT 0 1
INSERT INTO Groups_x_Users
VALUES (198081409, 2300155);
INSERT 0 1
INSERT INTO Groups_x_Users
VALUES (198081409, 2483126);
INSERT 0 1
INSERT INTO Groups_x_Users
VALUES (198081409, 3162776);
INSERT 0 1
INSERT INTO Groups_x_Users
VALUES (198081409, 3656763);
INSERT 0 1
INSERT INTO Groups_x_Users
VALUES (198081409, 4044482);
INSERT 0 1
INSERT INTO Groups_x_Users
VALUES (207840928, 2153814);
INSERT 0 1
INSERT INTO Groups_x_Users
VALUES (207840928, 2300155);
INSERT 0 1
INSERT INTO Groups_x_Users
VALUES (207840928, 3656763);
INSERT 0 1
-- TAG: Friendships
INSERT INTO Friendships
VALUES (1000912, 2153814, current_timestamp, to_timestamp('2022-12-31 12:00:00', 'YYYY-MM-DD HH:MI:SS'));
INSERT 0 1
INSERT INTO Friendships
VALUES (2153814, 1000912, current_timestamp, to_timestamp('2022-12-31 12:00:00', 'YYYY-MM-DD HH:MI:SS'));
INSERT 0 1
INSERT INTO Friendships
VALUES (2153814, 3656763, current_timestamp, to_timestamp('2022-12-31 12:00:00', 'YYYY-MM-DD HH:MI:SS'));
INSERT 0 1
INSERT INTO Friendships
VALUES (3656763, 2153814, current_timestamp, to_timestamp('2022-12-31 12:00:00', 'YYYY-MM-DD HH:MI:SS'));
INSERT 0 1
-- TAG: Posts
INSERT INTO Posts
VALUES
(216, -198081409, '–†–µ–±—è—Ç–∞, –Ω–∞—à–∏ —Å—Ç—É–¥–µ–Ω—Ç—ã —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ —Ö–æ—Ä–æ—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ —ç—Ç–æ–π –æ–ª–∏–º–ø–∏–∞–¥–µ. –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–≤–µ –æ–ª–∏–º–ø–∏–∞–¥—ã –º—ã –ø—Ä–æ—Å—Ç–æ –≤—ã–∏–≥—Ä—ã–≤–∞–ª–∏ (–ø—Ä–∞–≤–¥–∞ –≤ —Å—Ç–∞—Ä—à–µ–π –≥—Ä—É–ø–ø–µ).', to_timestamp(1649759495));
INSERT 0 1
INSERT INTO Posts
VALUES
(215, -198081409, '–î–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –§–ü–ú–ò. \n\n–ú—ã –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–∞–∑–≤–∏–≤–∞—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –§–ü–ú–ò —Å–æ —à–∫–æ–ª–∞–º–∏, –∫–∞–∫ —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏, —Ç–∞–∫ –∏ —Å—Ç–æ–ª–∏—á–Ω—ã–º–∏. –£–∂–µ –¥–≤–∞ –≥–æ–¥–∞ –¥–µ–π—Å—Ç–≤—É–µ—Ç –ø—Ä–æ–µ–∫—Ç [https:\/\/vk.com\/miptfpmi?w=wall-166330483_1656|‚Äú–ù–∞—Å—Ç–∞–≤–Ω–∏–∫ –±—É–¥—É—â–∏—Ö —Ñ–∏–∑—Ç–µ—Ö–æ–≤‚Äù], –≤ —Å–µ–Ω—Ç—è–±—Ä–µ —Å–æ—Å—Ç–æ–∏—Ç—Å—è –ø–µ—Ä–≤—ã–π –Ω–∞–±–æ—Ä –Ω–∞ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É [https:\/\/vk.com\/miptfpmi?w=wall-166330483_3386|‚Äú–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –≤ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–º –∏ IT-–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏‚Äù].', to_timestamp(1645013538));
INSERT 0 1
INSERT INTO Posts
VALUES
(214, -198081409, '–ú–û–î–ê–õ–¨–ù–ê–Ø –õ–û–ì–ò–ö–ê\n\n–í–µ—Å–Ω–æ–π-2022 –º–æ–∂–Ω–æ –ø—Ä–æ—Å–ª—É—à–∞—Ç—å, –æ—Å–≤–æ–∏—Ç—å –∏ —Å–¥–∞—Ç—å —Ñ–∞–∫—É–ª—å—Ç–∞—Ç–∏–≤–Ω—ã–π –∫—É—Ä—Å ¬´–ú–æ–¥–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞¬ª (–≤ —Ä–∞–º–∫–∞—Ö —Ñ–∞–∫—É–ª—å—Ç–∞—Ç–∏–≤–∞ ¬´–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–∏—Å–∫—Ä–µ—Ç–Ω–æ–π –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞¬ª). –ö—É—Ä—Å —á–∏—Ç–∞–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –∫–∞—Ñ–µ–¥—Ä—ã –ú–û–£ –°—Ç–µ–ø–∞–Ω–æ–≤ –ì—Ä–∏–≥–æ—Ä–∏–π.\n–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ t.me\/kripke_frame\n\n–ó–∞–Ω—è—Ç–∏—è –ø—Ä–æ–≤–æ–¥—è—Ç—Å—è –ø–æ –ø—è—Ç–Ω–∏—Ü–∞–º —Å 18:35 –¥–æ 20:00 –≤ 428 –≥–∫.\n–ü–µ—Ä–≤–æ–µ –∑–∞–Ω—è—Ç–∏–µ —Å–æ—Å—Ç–æ–∏—Ç—Å—è 11 —Ñ–µ–≤—Ä–∞–ª—è.', to_timestamp(1643888203));
INSERT 0 1
INSERT INTO Posts
VALUES
(215, -207840928, '–ò–¥–µ—è –¥–ª—è –ú–∞—Å–∫–æ—Ç–∞ –æ—Ç [id441636937|–ü–ª–∞—Å—Ç–∏–Ω–∏–Ω–æ–π –í–∞–ª–µ–Ω—Ç–∏–Ω—ã], –ë05-924–≤ ‚Äî ¬´–ó–∞–º–µ—á–∞—Ç–µ–ª—å–Ω–∞—è —Å–æ–≤–∞¬ª ü¶â\n\n–°–∏–º–≤–æ–ª–∏–∑–∏—Ä—É–µ—Ç —É–º –∏ —Å–º–µ–∫–∞–ª–∫—É –§–ü–ú–ò—à–Ω–∏–∫–æ–≤ ‚Äî —ç—Ç–æ —Ä–∞–∑! –û—Ç—Ä–∞–∂–∞–µ—Ç –Ω–∞—à—É —Ç—è–≥—É –∫ –∑–Ω–∞–Ω–∏—è–º ‚Äî —ç—Ç–æ –¥–≤–∞!\n\n#–º–∞—Å–∫–æ—Ç–§–ü–ú–ò', to_timestamp(1652530359));
INSERT 0 1
INSERT INTO Posts
VALUES
(214, -207840928, '–ö–∞—Ñ–µ–¥—Ä–∞ –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –§–ü–ú–ò –æ–±—ä—è–≤–ª—è–µ—Ç –Ω–∞–±–æ—Ä —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –¥–ª—è –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ –±–∞–∫–∞–ª–∞–≤—Ä–∏–∞—Ç\/–º–∞–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä—É –Ω–∞ —Å–æ–≤–º–µ—Å—Ç–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É —Å –ö–æ–Ω—Ü–µ—Ä–Ω–æ–º ¬´–ê–ª–º–∞–∑-–ê–Ω—Ç–µ–π¬ª\n\n–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å –æ–±—É—á–µ–Ω–∏–µ–º –Ω–∞ –∫–∞—Ñ–µ–¥—Ä–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ü–∏—Ñ—Ä–æ–≤–æ–π —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏. –†–∞–±–æ—Ç—ã –≤ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏ –≤–µ–¥—É—Ç—Å—è –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º, —Å–≤—è–∑–∞–Ω–Ω—ã–º —Å –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–º –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º, —Ü–∏—Ñ—Ä–æ–≤–æ–π —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –∫–∞–¥—Ä–æ–≤–æ–π –ø–æ–ª–∏—Ç–∏–∫–æ–π. –†–∞–±–æ—Ç—ã –∏–º–µ—é—Ç –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä, –∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å –≤–Ω–µ–¥—Ä–µ–Ω—ã –≤ –ö–æ–Ω—Ü–µ—Ä–Ω–µ –∏ —Å—Ç–∞—Ç—å –æ—Å–Ω–æ–≤–æ–π –¥–ª—è –¥–∏–ø–ª–æ–º–Ω–æ–π —Ä–∞–±–æ—Ç—ã.\n\nüìÖ –°–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è—Ç—Å—è: 19 –º–∞—è, 26 –º–∞—è –∏ 2 –∏—é–Ω—è —Å 16.00 –¥–æ 19.00 –æ—á–Ω–æ, –≤ –æ—Ñ–∏—Å–µ –±–∞–∑–æ–≤–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∫–∞—Ñ–µ–¥—Ä—ã –¶–µ–Ω—Ç—Ä–∞ ¬´–ö–æ–Ω—Ü–µ–ø—Ç¬ª –∏–ª–∏ —É–¥–∞–ª–µ–Ω–Ω–æ –≤ Skype. –ö–∞–∂–¥–æ–µ –∏–∑ –Ω–∏—Ö –∑–∞–π–º–µ—Ç –æ–∫–æ–ª–æ 15 –º–∏–Ω—É—Ç.\n\n‚ö°–î–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É: https:\/\/clck.ru\/h35PC\n–í—Ä–µ–º—è —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—è –∏ —Å—Å—ã–ª–∫–∞ –Ω–∞ Skype (–ø—Ä–∏ –≤—ã–±–æ—Ä–µ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—è) –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ –ø–æ—á—Ç—É, —É–∫–∞–∑–∞–Ω–Ω—É—é –≤ —Ñ–æ—Ä–º–µ. –ö —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—é –ø–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã, –∞ —Ç–∞–∫–∂–µ –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å: ¬´–ü–æ—á–µ–º—É –í—ã —Ö–æ—Ç–∏—Ç–µ —É—á–∏—Ç—å—Å—è –Ω–∞ –Ω–∞—à–µ–π –∫–∞—Ñ–µ–¥—Ä–µ?¬ª.\n\n–ë–æ–ª—å—à–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–∞—Ñ–µ–¥—Ä–µ –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –∑–¥–µ—Å—å:\n‚Ä¢ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–∞—Ñ–µ–¥—Ä—ã –Ω–∞ —Å–∞–π—Ç–µ –ú–§–¢–ò: https:\/\/vk.cc\/82NtJh\n‚Ä¢ –ó–∞–ø–∏—Å—å –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –∫–∞—Ñ–µ–¥—Ä—ã –≤ 2021 –≥–æ–¥—É: https:\/\/clck.ru\/h35Pz\n\n‚ùì –ü–æ –≤—Å–µ–º –≤–æ–ø—Ä–æ—Å–∞–º –º–æ–∂–Ω–æ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ —Å–µ–∫—Ä–µ—Ç–∞—Ä—é –∫–∞—Ñ–µ–¥—Ä—ã [id174564408|–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω—É –°–µ—Ä–∫–æ–≤—É]: –Ω–∞ –ø–æ—á—Ç—É kserkov@acconcept.ru –∏–ª–∏ Vk.\n\n–ë—É–¥–µ–º —Ä–∞–¥—ã –≤–∏–¥–µ—Ç—å –í–∞—Å –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏! –û—Ñ–∏—Å –¶–µ–Ω—Ç—Ä–∞ ¬´–ö–æ–Ω—Ü–µ–ø—Ç¬ª —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: –º. –ö–∏—Ç–∞–π-–≥–æ—Ä–æ–¥, —É–ª. –°–æ–ª—è–Ω–∫–∞, –¥. 3, —Å—Ç—Ä. 1, –∫–∞–±.46', to_timestamp(1652457938));
INSERT 0 1
INSERT INTO Posts
VALUES
(211, -207840928, '11 –º–∞—è –≤ 19:00 –ø–æ–¥–∫–ª—é—á–∞–π—Ç–µ—Å—å –∫ –æ–Ω–ª–∞–π–Ω-–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –º–∞–≥–∏—Å—Ç–µ—Ä—Å–∫–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã X5 Group ‚Äî ¬´–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–∏—Ç–µ–π–ª–µ¬ª\n\n–ú–∏—Ö–∞–∏–ª –•–æ–∑–∏–Ω, –∑–∞–º–µ—Å—Ç–∏—Ç–µ–ª—å –∑–∞–≤–µ–¥—É—é—â–µ–≥–æ –∫–∞—Ñ–µ–¥—Ä–æ–π —Ä–∞—Å—Å–∫–∞–∂–µ—Ç:\n‚Ä£ –ü–æ—á–µ–º—É data science –≤ —Ä–∏—Ç–µ–π–ª–µ —ç—Ç–æ –Ω–µ –ø—Ä–æ –∞–Ω–∞–ª–∏—Ç–∏–∫—É \"–≤ —Å—Ç–æ–ª\";\n‚Ä£ –ß—Ç–æ —Ç–µ–±—è –∂–¥–µ—Ç –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –æ–±—É—á–µ–Ω–∏—è (—Å–ø–∏—Å–æ–∫ –∫—É—Ä—Å–æ–≤ –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∫–µ–π—Å—ã);\n‚Ä£ –ß—Ç–æ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –ø—Ä–æ–π—Ç–∏ –æ—Ç–±–æ—Ä;\n‚Ä£ –ö—Ç–æ —Ç–∞–∫–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫ –æ—Ç –±–∏–∑–Ω–µ—Å-–∫–µ–π—Å–∞ –¥–æ post-production –∏ –ø–æ—á–µ–º—É –∫—Ä—É—Ç–æ –∏–º –±—ã—Ç—å.\n\n+ bonus –æ—Ç HR X5Tech: –ú–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å ¬´–ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å —Å–∏–ª—å–Ω–æ–µ —Ä–µ–∑—é–º–µ –∏ –ø—Ä–æ–π—Ç–∏ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ –º–æ–ª–æ–¥–æ–º—É –¥–∞—Ç–∞-—Å–∞–µ–Ω—Ç–∏—Å—Ç—É¬ª.\n\n ‚ö°–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è: https:\/\/clck.ru\/guzYB\n\nüîó –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –∫–∞—Ñ–µ–¥—Ä–µ:\n–ó–∞–ø–∏—Å—å –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –ø—Ä–æ—à–ª–æ–≥–æ –≥–æ–¥–∞: https:\/\/clck.ru\/guzdp\n–°–∞–π—Ç –∫–∞—Ñ–µ–¥—Ä—ã: https:\/\/mipt.x5.ru\/\n\nüìπ –°—Å—ã–ª–∫–∞ –Ω–∞ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—é:\nVk: https:\/\/clck.ru\/guzhd\nYouTube: https:\/\/clck.ru\/guzh5\n\n#–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏_–∫–∞—Ñ–µ–¥—Ä_—Ñ–ø–º–∏ #–º–∞–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä–∞–§–ü–ú–ò', to_timestamp(1651933738));
INSERT 0 1
-- TAG: Comments
INSERT INTO Comments
VALUES
(216, -207840928, 215, 156692231, '–ö–æ–Ω–µ—á–Ω–æ –∂–µ 2–æ–π –≤–∞—Ä–∏–∞–Ω—Ç. –õ–æ–ª. Gold on my wrist', 0);
INSERT 0 1
INSERT INTO Comments
VALUES
(219, -207840928, 215, 328862944, '–ó–∞—è–≤–∫–∞ –Ω–∞ –ø–æ–±–µ–¥—É!', 0);
INSERT 0 1
INSERT INTO Comments
VALUES
(220, -207840928, 215, 453008630, '–ê –ø–æ—á–µ–º—É —Å–æ–≤–∞ –∂–µ–ª—Ç–æ-—Å–∏–Ω—è—è?ü§°', 1);
INSERT 0 1
INSERT INTO Comments
VALUES
(221, -207840928, 215, 212943330, '–Ω–µ–º–Ω–æ–≥–æ –±–∞–Ω–∞–ª—å–Ω–æ', 0);
INSERT 0 1
set search_path = vk_audience;
SET
-- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∞–∫–∫–∞—É–Ω—Ç–æ–≤, –æ—Å–Ω–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ —Å–≤–æ–π—Å—Ç–≤–∞—Ö –∞–∫–∫–∞—É–Ω—Ç–∞
DELETE FROM Users WHERE deactivated = 'banned';
DELETE 0
DELETE FROM Users WHERE deactivated = 'deleted';
DELETE 0
DELETE FROM Users WHERE can_access_closed = False;
DELETE 4
-- –ß–∞—Å—Ç—å –∏–∑ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
UPDATE Users SET total_friends = 1004 WHERE user_id = 1000912;
UPDATE 1
UPDATE Users SET total_friends = 552 WHERE user_id = 1151988;
UPDATE 1
UPDATE Users SET total_friends = 2274 WHERE user_id = 2153814;
UPDATE 1
UPDATE Users SET total_friends = 218 WHERE user_id = 2300155;
UPDATE 1
UPDATE Users SET total_friends = 499 WHERE user_id = 2483126;
UPDATE 1
UPDATE Users SET total_friends = 1851 WHERE user_id = 3656763;
UPDATE 1
-- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∞–∫–∫–∞—É–Ω—Ç–æ–≤, –æ—Å–Ω–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ –¥—Ä—É–∂–µ—Å–∫–∏—Ö —Å–≤–æ–π—Å—Ç–≤–∞—Ö
DELETE FROM Users WHERE total_friends < 50;
DELETE 0
DELETE FROM Friendships f USING (SELECT friend_id FROM Friendships a LEFT JOIN Users b ON a.friend_id = b.user_id WHERE b.user_id IS NULL) d WHERE f.friend_id = d.friend_id;
DELETE 0
-- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ - —É–¥–∞–ª—è–µ—Ç –Ω–µ–¥—Ä—É–∂–µ–ª—é–±–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã
/*
DELETE FROM Users p USING (SELECT a.user_id FROM Users a LEFT JOIN Friendships b ON a.user_id = b.user_id WHERE b.user_id IS NULL) d WHERE p.user_id = d.user_id;
*/
-- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –∫–∞–∫ —ç—Ç–æ –∏ –±—ã–≤–∞–µ—Ç –≤ –∂–∏–∑–Ω–∏
UPDATE Comments SET likes = Comments.likes + 1
WHERE Comments.comment_id = 216
AND Comments.owner_id = -207840928
AND Comments.post_id = 215;
UPDATE 1
UPDATE Comments SET likes = 7
WHERE Comments.comment_id = 219
AND Comments.owner_id = -207840928
AND Comments.post_id = 215;
UPDATE 1
-- –ü—Ä–∏–º–µ—Ä —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
DELETE FROM Comments WHERE text SIMILAR TO '%[a-zA-Z]%';
DELETE 1
SELECT FROM Comments WHERE text SIMILAR TO '[–∞-—è–ê-–Ø]*';
--
(0 rows)

-- –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–π –≤—ã–∫–∞—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö (–ø–æ–¥—Ä–æ–±–Ω–µ–µ –≤ 6.sql)
-- SELECT array_to_json(array_agg(row_to_json(u))) FROM Users u;
set search_path = vk_audience;
SET
-- –ü–æ–ª—É—á–µ–Ω–∏–µ –¥—Ä—É–∑–µ–π –Ω–µ–∫–æ—Ç–æ—Ä–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 
SELECT friend_id FROM Friendships WHERE user_id = 3656763;
 friend_id 
-----------
   2153814
(1 row)

-- –ì—Ä—É–ø–ø—ã –Ω–µ–∫–æ—Ç–æ—Ä–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
SELECT group_id FROM Groups_x_Users WHERE user_id = 3656763;
 group_id  
-----------
 198081409
 207840928
(2 rows)

-- –£–ø–æ—Ä—è–¥–æ—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –≤–æ–≤–ª–µ—á—ë–Ω–Ω–æ—Å—Ç–∏ –≤ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ 
SELECT
a.user_id,
a.total_friends,
(CASE WHEN b.local_friends IS NULL THEN 0 ELSE b.local_friends END),
(CASE WHEN b.ulikes IS NULL THEN 0 ELSE b.ulikes END),
(   (CASE WHEN b.local_friends IS NULL THEN 0 ELSE b.local_friends END) * 500 +
    (CASE WHEN b.ulikes IS NULL THEN 0 ELSE b.ulikes END)* 0.01 +
    total_friends
) score
FROM
Users a
JOIN
(
    SELECT DISTINCT
    u.user_id,
    COUNT(f.friend_id) OVER (PARTITION BY u.user_id) AS local_friends,
    SUM(c.likes) OVER (PARTITION BY u.user_id) AS ulikes
    FROM
    Users u
    LEFT JOIN
    Friendships f
    ON
    u.user_id = f.user_id
    LEFT JOIN
    Comments c
    ON u.user_id = c.author_id
) AS b
ON a.user_id = b.user_id
ORDER BY score;
 user_id | total_friends | local_friends | ulikes |  score  
---------+---------------+---------------+--------+---------
 2300155 |           218 |             0 |      0 |  218.00
 2483126 |           499 |             0 |      0 |  499.00
 1151988 |           552 |             0 |      0 |  552.00
 1000912 |          1004 |             1 |      0 | 1504.00
 3656763 |          1851 |             1 |      0 | 2351.00
 2153814 |          2274 |             2 |      0 | 3274.00
(6 rows)

-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è —É –¥–∞–Ω–Ω–æ–≥–æ –æ–±–ª–∞–¥–∞—Ç–µ–ª—è (–≥—Ä—É–ø–ø–∞/–∏–Ω—Ñ–ª—é–µ–Ω—Å–µ—Ä)
SELECT comment_id, post_id FROM Comments WHERE owner_id = -207840928;
 comment_id | post_id 
------------+---------
        220 |     215
        221 |     215
        219 |     215
(3 rows)

-- 3 —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –∫ –Ω–µ–∫–æ—Ç–æ—Ä–æ–º—É –ø–æ—Å—Ç—É
SELECT comment_id, text
FROM Comments
WHERE post_id = 215 AND owner_id = -207840928
ORDER BY likes
LIMIT 3;
 comment_id |            text             
------------+-----------------------------
        221 | –Ω–µ–º–Ω–æ–≥–æ –±–∞–Ω–∞–ª—å–Ω–æ
        220 | –ê –ø–æ—á–µ–º—É —Å–æ–≤–∞ –∂–µ–ª—Ç–æ-—Å–∏–Ω—è—è?ü§°
        219 | –ó–∞—è–≤–∫–∞ –Ω–∞ –ø–æ–±–µ–¥—É!
(3 rows)

-- –ù–∞–π—Ç–∏ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ Users, –Ω–∞–ø–∏—Å–∞–≤—à–∏—Ö –±–æ–ª–µ–µ –æ–¥–Ω–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
SELECT user_id FROM
Users u JOIN Comments c ON u.user_id = c.author_id
GROUP BY u.user_id
HAVING COUNT(c.comment_id) > 1;
 user_id 
---------
(0 rows)

-- –ù–∞–π—Ç–∏ –∫–≤–∞–Ω—Ç–∏–ª–∏ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –¥—Ä—É–∑–µ–π –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –≤—Å–µ–π –±–∞–∑—ã
SELECT user_id, CAST((ROW_NUMBER() OVER (ORDER BY total_friends)) AS FLOAT) / (SELECT COUNT(*) FROM Users) AS quantile
FROM Users;
 user_id |     quantile      
---------+-------------------
 2300155 | 0.166666666666667
 2483126 | 0.333333333333333
 1151988 |               0.5
 1000912 | 0.666666666666667
 3656763 | 0.833333333333333
 2153814 |                 1
(6 rows)

-- –ù–∞–π—Ç–∏ –¥—Ä—É–∑–µ–π –¥–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã–π –º–æ–º–µ–Ω—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä —Å–µ–π—á–∞—Å
SELECT friend_id FROM Friendships
WHERE current_timestamp >= valid_from_dtm
AND current_timestamp <= valid_to_dtm 
AND user_id = 3656763;
 friend_id 
-----------
   2153814
(1 row)

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è –≤ –≤–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç–∏ 
SELECT
user_id, friend_id,
prev_valid_from_dtm, prev_valid_to_dtm,
valid_from_dtm, valid_to_dtm
FROM (
    SELECT
    user_id,
    friend_id,
    LAG(valid_from_dtm) OVER (PARTITION BY user_id, friend_id
        ORDER BY valid_from_dtm) AS prev_valid_from_dtm,
    LAG(valid_to_dtm) OVER (PARTITION BY user_id, friend_id
        ORDER BY valid_from_dtm) AS prev_valid_to_dtm,
    valid_from_dtm,
    valid_to_dtm
    FROM Friendships
) t
WHERE valid_from_dtm <= prev_valid_to_dtm;
 user_id | friend_id | prev_valid_from_dtm | prev_valid_to_dtm | valid_from_dtm | valid_to_dtm 
---------+-----------+---------------------+-------------------+----------------+--------------
(0 rows)

-- –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–π —Ç–∞–±–ª–∏—Ü—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ json
-- SELECT array_to_json(array_agg(row_to_json(u))) FROM Users u;
set search_path = vk_audience;
SET
-- –ü–æ–º–æ–∂–µ—Ç –≤ WHERE –ø–æ id –∏ –≤ JOIN –ø–æ id
CREATE INDEX ON Users(user_id);
CREATE INDEX
CREATE INDEX ON Groups(group_id);
CREATE INDEX
CREATE INDEX ON Influencers(user_id);
CREATE INDEX
CREATE INDEX ON Posts(owner_id, post_id);
CREATE INDEX
CREATE INDEX ON Comments(owner_id, post_id, comment_id);
CREATE INDEX
set search_path = vk_audience;
SET
-- –°–∫—Ä—ã–≤–∞—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã
CREATE VIEW UserIds AS
SELECT user_id, can_access_closed, is_closed, deactivated, total_friends 
FROM Users
WITH CASCADED CHECK OPTION;
CREATE VIEW
CREATE VIEW GroupIds AS
SELECT group_id 
FROM Groups
WITH CASCADED CHECK OPTION;
CREATE VIEW
CREATE VIEW InfluencerIds AS
SELECT user_id
FROM Influencers
WITH CASCADED CHECK OPTION;
CREATE VIEW
-- –†–∞—Å–∫—Ä—ã–≤–∞—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã
CREATE VIEW UserStatistics AS
SELECT
a.user_id,
a.total_friends,
(CASE WHEN b.local_friends IS NULL THEN 0 ELSE b.local_friends END),
(CASE WHEN b.ulikes IS NULL THEN 0 ELSE b.ulikes END)
FROM
Users a
JOIN
(
    SELECT DISTINCT
    u.user_id,
    COUNT(f.friend_id) OVER (PARTITION BY u.user_id) AS local_friends,
    SUM(c.likes) OVER (PARTITION BY u.user_id) AS ulikes
    FROM
    Users u
    LEFT JOIN
    Friendships f
    ON
    u.user_id = f.user_id
    LEFT JOIN
    Comments c
    ON u.user_id = c.author_id
) AS b
ON a.user_id = b.user_id;
CREATE VIEW
CREATE VIEW CurrentFriendships AS
SELECT user_id, friend_id
FROM Friendships
WHERE current_timestamp >= valid_from_dtm
AND current_timestamp <= valid_to_dtm
WITH CASCADED CHECK OPTION;
CREATE VIEW
CREATE VIEW InfluencerSubscribers AS
SELECT b.user_id, b.first_name, b.last_name, a.first_name inf_first_name, a.last_name inf_last_name
FROM
Influencers_x_Users ab
JOIN
Influencers a
ON
ab.influencer_id = a.user_id
JOIN
Users b
ON
ab.user_id = b.user_id;
CREATE VIEW
CREATE VIEW GroupMembers AS
SELECT b.user_id, b.first_name, b.last_name, a.name
FROM
Groups_x_Users ab
JOIN
Groups a
ON
ab.group_id = a.group_id
JOIN
Users b
ON
ab.user_id = b.user_id;
CREATE VIEW
set search_path = vk_audience;
SET
CREATE FUNCTION invalidate_friendships(id bigint)
RETURNS void
AS $$
DECLARE
BEGIN
    UPDATE Friendships SET valid_to_dtm = current_timestamp WHERE user_id = id;
    UPDATE Friendships SET valid_to_dtm = current_timestamp WHERE friend_id = id;
END
$$ LANGUAGE plpgsql;
CREATE FUNCTION
CREATE FUNCTION sync_friendships()
RETURNS void
AS $$
DECLARE
   rec   record;
BEGIN
    FOR rec IN SELECT * FROM CurrentFriendships
    LOOP
        IF (rec.friend_id, rec.user_id) not in (SELECT * FROM CurrentFriendships) THEN
            INSERT INTO Friendships
            VALUES (rec.friend_id, rec.user_id, current_timestamp, to_timestamp('2022-12-31 12:00:00', 'YYYY-MM-DD HH:MI:SS'));
        END IF;
   END LOOP;
END
$$ LANGUAGE plpgsql;
CREATE FUNCTION
CREATE FUNCTION sync_one_friendship()
RETURNS trigger
AS $$
DECLARE
BEGIN
    IF (NEW.friend_id, NEW.user_id) not in (SELECT * FROM CurrentFriendships) THEN
        INSERT INTO Friendships
        VALUES (NEW.friend_id, NEW.user_id, current_timestamp, to_timestamp('2022-12-31 12:00:00', 'YYYY-MM-DD HH:MI:SS'));
    END IF;
END
$$ LANGUAGE plpgsql;
CREATE FUNCTION
set search_path = vk_audience;
SET
CREATE TRIGGER fix_friendships
AFTER INSERT ON Friendships
REFERENCING NEW TABLE AS NEW
FOR EACH STATEMENT
EXECUTE PROCEDURE sync_one_friendship();
CREATE TRIGGER
set search_path = vk_audience;
SET
drop trigger if exists fix_friendships ON Friendships;
DROP TRIGGER
drop function if exists invalidate_friendships(bigint);
DROP FUNCTION
drop function if exists sync_friendships();
DROP FUNCTION
drop function if exists sync_one_friendship();
DROP FUNCTION
drop view if exists UserIds;
DROP VIEW
drop view if exists GroupIds;
DROP VIEW
drop view if exists InfluencerIds;
DROP VIEW
drop view if exists UserStatistics;
DROP VIEW
drop view if exists CurrentFriendships;
DROP VIEW
drop view if exists InfluencerSubscribers;
DROP VIEW
drop view if exists GroupMembers;
DROP VIEW
drop table if exists Users cascade;
DROP TABLE
drop table if exists Groups cascade;
DROP TABLE
drop table if exists Groups_x_Users cascade;
DROP TABLE
drop table if exists Influencers cascade;
DROP TABLE
drop table if exists Influencers_x_Users cascade;
DROP TABLE
drop table if exists Posts cascade;
DROP TABLE
drop table if exists Comments cascade;
DROP TABLE
drop table if exists Friendships cascade;
DROP TABLE
drop schema if exists vk_audience;
DROP SCHEMA
